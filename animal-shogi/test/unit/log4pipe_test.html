<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
  <title>log4pipe Unit test file</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="../../css/global.css" />
  <link rel="stylesheet" type="text/css" href="../../css/log4pipe.css" />
  <link rel="stylesheet" href="../../test/test.css" type="text/css" />
  <script src="../../lib/prototype.js"></script>
  <script type="text/javascript" src="../../lib/scriptaculous/scriptaculous.js?load=effects,dragdrop,resizable"></script>
  <script type="text/javascript" src="../../lib/livepipe/livepipe.js"></script>
  <script type="text/javascript" src="../../lib/livepipe/window.js"></script>
  <script src="../../lib/log4pipe.js"></script>
  <script src="../../lib/unittest.js" type="text/javascript"></script>
  <style type="text/css" media="screen">
  /* <![CDATA[ */
    #div_absolute_test { position: absolute }
  /* ]]> */
  </style>
  
</head>
<body>
<div id="logtest"></div>
<div id="message-body"></div>

<h1>log4pipe Unit test file</h1>
<p>
  Test of Log in log4pipe.js
</p>

<!-- Log output -->
<div id="testlog"> </div>

<!-- Tests follow -->
<script type="text/javascript" language="javascript" charset="utf-8">
// <![CDATA[
  var elem = null;
  var title = '';
  var TestCounter = 0;
  var logObj = null;
  var TestSuitePopup = {
  
  setup: function() { with( this ) {
    title = 'popup' + TestCounter;
    HOST = 'http://skkmania.sakura.ne.jp/animal-shogi/';
  } },
  // Log のinitilalize時に渡すoptionsの意味：
  // title : popup Logger の場合、log windowをopenするときのタイトル
  // host  : popup Logger の場合、log windowに付加するprototype.jsの置き場所

  teardown: function() { with( this ) {
    TestCounter++;
    logObj.window.close();
    delete logObj;
  } },

  testOpen : function() {  with( this )  {
    logObj = new Log(Log.DEBUG, 'popup', { 'title': title, 'host' : HOST });
    logObj.debug('test Open');
    logObj.window.open();
  } },

  testInitializeWithoutOption : function() {  with( this )  {
    logObj = new Log(Log.DEBUG, 'popup', { 'title': title, 'host' : HOST });
    assertEqual( title, logObj.title );
  } },

  testContainer : function() { with( this ) {
    elem = new Element('a',{'id':'cont01','href':'#cont01','title':'log'});
    elem.insert('popup logger test container');
    $('links_pool').appendChild(elem);
    title += '_cont01';
    logObj = new Log(Log.DEBUG, 'popup', { 'container':'cont01', 'title': title, 'host' : HOST });
    logObj.debug('test Container');
  } },

  testEntry : function() { with( this ) {
    logObj = new Log(Log.DEBUG, 'popup', { 'title': title, 'host' : HOST });
    logObj.debug('test written');
  } },

  testMakeRectangle : function() { with( this ) {
    logObj = new Log(Log.DEBUG, 'popup', { 'title': title, 'host' : HOST });
    makeRectangle(1,2,3,4);
    logObj.window.open();
  } },

  testMaxHight : function() { with( this ) {
    logObj = new Log(Log.DEBUG, 'popup',
       { 'title': title, 'host' : HOST , 'resizable':true, 'maxHeight':'150px'});
    makeRectangle(1,2,3,4);
    logObj.window.open();
  } },

  testDraggableTrue : function() { with( this ) {
    title += '_draggable_true';
    logObj = new Log(Log.DEBUG, 'popup', { 'draggable':true, 'title': title, 'host' : HOST, 'position':'relative' });
    logObj.window.open();
  } },

  testRelative : function() { with( this ) {
    title += '_relative';
    logObj = new Log(Log.DEBUG, 'popup', { 'title': title, 'host' : HOST, 'position':'relative' });
    logObj.window.open();
  } },

  testPositionMouse: function() { with( this ) {
    title += '_mouse';
    logObj = new Log(Log.DEBUG, 'popup', { 'title': title, 'host' : HOST, 'position':'mouse' });
    logObj.window.open();
  } },

  testPositionArray: function() { with( this ) {
    title += '_array';
    logObj = new Log(Log.DEBUG, 'popup', { 'title': title, 'host' : HOST, 'position':[150,150] });
    logObj.window.open();
  } },

  testIframe : function() {  with( this )  {
    title += '_iframe';
    logObj = new Log(Log.DEBUG, 'popup', { 'iframe':true, 'title': title, 'host' : HOST });
    assertEqual( 'dummy', obj.toString() );
  } },

  testToString : function() {  with( this )  {
    logObj = new Log(Log.DEBUG, 'popup', { 'title': title, 'host' : HOST });
    assertEqual( 'dummy', obj.toString() );
  } }
  };
  new Test.Unit.Runner(TestSuitePopup, "testlog");
// ]]>
</script>
<script>
function funcB(x,y){
  var div = logObj.getInto();
  logObj.debug("entering funcB");
  x = x * 8;
  logObj.debug("x was multiplied by 8, x became " + x);
  y = y * 3;
  logObj.debug("y was multiplied by 3");
  logObj.debug("leaving funcB");
  logObj.goOut();
  return x + y;
}

function funcA(x,y){
  var div = logObj.getInto();
  logObj.debug("entering funcA");
  x = x * 10;
  logObj.debug("x was multiplied by 10");
  funcB(3,2);
  y = y * 5;
  logObj.debug("y was multiplied by 5");
  logObj.debug("leaving funcA");
  logObj.goOut();
  return x + y;
}

function makeRectangle(x,y,w,h){
  logObj.debug("start logging");
  logObj.debug("entering makeRectangle");
  var r = {x:x, y:y, size: { w:w, h:h }};
  funcA(1,2);
  //logObj.options.timestamp = true;
  logObj.debug("new Rectangle", r);
  //logObj.options.timestamp = false;
  logObj.debug("exiting makeRectangle");
  return r;
}
</script>
<!--
  <button onclick="makeRectangle(1,2,3,4);">Make Rectangle</button>
--!>
  <h2>ドラッグ可能なlogウィンドウ</h2>
  <div id='links_pool'>
    <a 
       href="#logger" 
       id="popup_logger" title="popup logger">
         popup logger
     </a><br>
    <a href="#logger2" id="popup_logger2" title="popup logger 2"> popup logger 2 </a>
  </div>
</body>
</html>
