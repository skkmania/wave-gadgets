<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
  <title>log4pipe Unit test file</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="../../css/global.css" />
  <link rel="stylesheet" type="text/css" href="../../css/log4pipe.css" />
  <link rel="stylesheet" href="../../test/test.css" type="text/css" />
  <script src="../../lib/prototype.js"></script>
  <script type="text/javascript" src="../../lib/scriptaculous/scriptaculous.js?load=effects,dragdrop,resizable"></script>
  <script type="text/javascript" src="../../lib/livepipe/livepipe.js"></script>
  <script type="text/javascript" src="../../lib/livepipe/window.js"></script>
  <script src="../../lib/log4pipe.js"></script>
  <script src="../../lib/unittest.js" type="text/javascript"></script>
  <style type="text/css" media="screen">
  /* <![CDATA[ */
    #div_absolute_test { position: absolute }
    #links_pool a { margin-left: 10px; }
  /* ]]> */
  </style>
  
</head>
<body>
<div id="logtest"></div>
<div id="message-body"></div>

<h1>log4pipe Unit test file</h1>
<p>
  Test of Log in log4pipe.js
</p>

<!-- Log output -->
<div id="testlog"> </div>

<!-- Tests follow -->
<script type="text/javascript" language="javascript" charset="utf-8">
// <![CDATA[
  var elem = null;
  var HOST = 'http://skkmania.sakura.ne.jp/animal-shogi/';
  var TestCounter = 0;
  var logObj = null;

  function getContainerId(){
    return 'cont' + TestCounter;
  }
  function getTitle(){
    return 'popup' + TestCounter;
  }
  function getDefaultOptions(){
    return  { 'container': getContainerId(), 'title': getTitle(), 'host' : HOST }
  }

  function makeLogObj(options){
    var opt = (options || getDefaultOptions());
    opt['container'] = getContainerId();
    var href = '#logger' + TestCounter;
    elem = new Element('a',{'id':getContainerId(), 'href':href, 'title':'log'});
    elem.insert('popup logger ' + TestCounter);
    $('links_pool').appendChild(elem);
    logObj = new Log(Log.DEBUG, 'popup', opt);
  }

  var TestSuitePopup = {
  setup: function() { with( this ) {
    title = 'popup' + TestCounter;
  } },

  teardown: function() { with( this ) {
    TestCounter++;
    logObj.window.close();
    delete logObj;
  } },

  testOpen : function() {  with( this )  {
    makeLogObj({ 'container': getContainerId(), 'title': getTitle(), 'host' : HOST });
    logObj.debug('test Open');
    logObj.window.open();
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testContainer : function() { with( this ) {
    makeLogObj();
    logObj.debug('test Container');
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testEntry : function() { with( this ) {
    makeLogObj();
    logObj.debug('test written');
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testCloseOnClick : function() { with( this ) {
    makeLogObj({ 'closeOnClick': true });
    logObj.debug('test closeOnClick');
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testMakeRectangle : function() { with( this ) {
    makeLogObj();
    makeRectangle(1,2,3,4);
    logObj.window.open();
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testMaxHight : function() { with( this ) {
    makeLogObj({ 'title': title, 'host' : HOST , 'resizable':true, 'maxHeight':'150px'});
    logObj.debug('test MaxHight');
    logObj.debug('this logObjs id : ' + logObj.window.container.id);
    makeRectangle(1,2,3,4);
    logObj.window.open();
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testDraggableTrue : function() { with( this ) {
    title += '_draggable_true';
    makeLogObj({ 'draggable':true, 'title': title, 'host' : HOST, 'position':'relative' });
    logObj.window.open();
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testRelative : function() { with( this ) {
    title += '_relative';
    makeLogObj( { 'title': title, 'host' : HOST, 'position':'relative' });
    logObj.debug('test relative debug');
    logObj.warn('test relative warn');
    logObj.fatal('test relative fatal');
    logObj.error('test relative error');
    logObj.window.open();
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testPositionMouse: function() { with( this ) {
    title += '_mouse';
    makeLogObj( { 'title': title, 'host' : HOST, 'position':'mouse' });
    logObj.debug('test position mouse');
    //logObj.window.open();
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testPositionArray: function() { with( this ) {
    title += '_array';
    makeLogObj( { 'title': title, 'host' : HOST, 'position':[150,150] });
    logObj.debug('test position array');
    logObj.window.open();
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testIframe : function() {  with( this )  {
    title += '_iframe';
    makeLogObj( { 'iframe':true, 'title': title, 'host' : HOST });
    logObj.debug('test iframe');
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } },

  testToString : function() {  with( this )  {
    makeLogObj();
    logObj.debug('test toString');
    assertEqual(TestCounter+1, Control.Window.windows.length);
  } }
  };
  new Test.Unit.Runner(TestSuitePopup, "testlog");
// ]]>
</script>
<script>
function funcB(x,y){
  var div = logObj.getInto();
  logObj.debug("entering funcB");
  x = x * 8;
  logObj.debug("x was multiplied by 8, x became " + x);
  y = y * 3;
  logObj.debug("y was multiplied by 3");
  logObj.debug("leaving funcB");
  logObj.goOut();
  return x + y;
}

function funcA(x,y){
  var div = logObj.getInto();
  logObj.debug("entering funcA");
  x = x * 10;
  logObj.debug("x was multiplied by 10");
  funcB(3,2);
  y = y * 5;
  logObj.debug("y was multiplied by 5");
  logObj.debug("leaving funcA");
  logObj.goOut();
  return x + y;
}

function makeRectangle(x,y,w,h){
  logObj.debug("start logging");
  logObj.debug("entering makeRectangle");
  var r = {x:x, y:y, size: { w:w, h:h }};
  funcA(1,2);
  //logObj.options.timestamp = true;
  logObj.debug("new Rectangle", r);
  //logObj.options.timestamp = false;
  logObj.debug("exiting makeRectangle");
  return r;
}
</script>
<!--
  <button onclick="makeRectangle(1,2,3,4);">Make Rectangle</button>
--!>
  <h2>ドラッグ可能なlogウィンドウ</h2>
  <div id='links_pool'>
    <a href="#logger" id="popup_logger" title="popup logger"> default container </a>
  </div>
  <div id="logger0"></div>
  <div id="logger1"></div>
  <div id="logger2"></div>
  <div id="logger3"></div>
  <div id="logger4"></div>
  <div id="logger9"></div>
  <div id="logger10"></div>
  <div id="logger11"></div>
</body>
</html>
