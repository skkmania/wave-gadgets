<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
<ModulePrefs title="State Example" height="450">
  <Require feature="rpc" /> 
  <Require feature="wave" /> 
</ModulePrefs>
<Content type="html">
<![CDATA[ 
<script src="http://skkmania.sakura.ne.jp/animal-shogi/prototype.js"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/scriptaculous.js"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/builder.js"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/effects.js"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/controls.js"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/slider.js"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/dragdrop.js"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/m17n.js" charset="UTF-8"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/dw.js" charset="UTF-8"></script>
<script src="http://skkmania.sakura.ne.jp/animal-shogi/animal-shogi.js" charset="UTF-8"></script>
<script>
  function init() {
alert('init 00');
    window.game = new AnimalShogiGame({containerId:'animal-shogi'});
alert('init 01');
    if (wave && wave.isInWaveContainer()) {
      wave.setStateCallback(window.game.stateChanged.bind(window.game));
    }
alert('init 02');
    window.game.show();
  }
alert('init 03');
  gadgets.util.registerOnLoadHandler(init);
</script>
<link rel="stylesheet" href="http://skkmania.sakura.ne.jp/animal-shogi/animal-shogi.css" type="text/css" />
<div id="test">
  <button onclick="window.game.setPlayer(wave.getViewer().getId())">Join</button>
  <button onclick="window.game.setPlayer(new wave.Participant().getId(), true);">Add Player</button>
  <button onclick="javascript:window.game.nextTurn()">Next Turn</button>
  <input id="state" value="piece:'giraffe_player2', from:[0,0], to:[0,1]" style="width:250px" />
  <script>
    function invokeMove() {
      var value = eval('({' + $('state').value + '})');
alert('value: ' + value);
      var piece = Piece.selectByName(value.piece);
      var fromCell = window.game.board.getCell(value.from[0], value.from[1]);
      var toCell = window.game.board.getCell(value.to[0], value.to[1]);
      piece.move(fromCell, toCell);
      window.game.nextTurn();
    }
  </script>
  <button onclick="javascript:invokeMove(); $('state').value = 'piece:\'giraffe_player2\', from:[0,1], to:[0,2]'">Move</button>
  <button onclick="javascript:$('json').innerHTML = window.game.toHTML()">toJSON</button>
</div>

<div id="sidebar">
  <div id="control-panel" class="sidebar-panel">
    <div id="top-panel" class="player"><span class="t">gote</span><span class="t">waiting</span></div>

  <div id="captured" class="sidebar-panel">
    <h2 class="t">captured</h2>
    <div id="top-captured">
      <div id="opponent-captured"></div>
    </div>
    <div id="message" class="sidebar-panel">
      <h2 class="t">message</h2>
      <div id="message-body"></div>
    </div>

    <h2 class="t">captured</h2>
    <div id="bottom-captured">
      <div id="my-captured"></div>
    </div>
  </div>

    <div id="bottom-panel" class="player"><span class="t">sente</span><span class="t">waiting</span></div>
  </div>

      <div style="text-align:left;">
    	<button id="reverse-button" class="reverse t" onclick="window.game.reverse();">reverse</button>
      </div>
      <div style="text-align:right;">
    	<button id="dump-button" class="dump t" onclick="window.game.debug_dump();">dump</button>
      </div>

  <div style="text-align:right;">
    <a href="http://en.wikipedia.org/wiki/D%C5%8Dbutsu_sh%C5%8Dgi" target="_blank" class="t">help</a>
  </div>
</div>
<div id="animal-shogi"></div>

<button id="join-button" class="join t" onclick="window.game.setPlayer(wave.getViewer().getId()); this.hide();">join</button>

<!--pre id="json" style="margin-top:380px;"></pre-->
]]> 
</Content>
</Module>
